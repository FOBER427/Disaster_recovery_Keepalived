# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –•–æ–º—è–∫–æ–≤–∞ –ê–Ω—Ç–æ–Ω–∞ –∫ –∑–∞–Ω—è—Ç–∏—é 1 ¬´Disaster recovery –∏ Keepalived¬ª 


### –¶–µ–ª—å –∑–∞–¥–∞–Ω–∏—è

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –≤—ã –Ω–∞—É—á–∏—Ç–µ—Å—å:
1. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ HSRP;
2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å Keepalived –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–ª–∞–≤–∞—é—â–µ–≥–æ IP

-----

### –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥–æ–º–∞—à–Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—é

1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ Cisco Packet Tracer
2. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Ubuntu –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –∏ –∏–º–µ–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É
3. –°–¥–µ–ª–∞–Ω –∫–ª–æ–Ω —ç—Ç–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã, –æ–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π –ø–æ–¥—Å–µ—Ç–∏ –∏ –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–µ IP –∞–¥—Ä–µ—Å–∞
4. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º—ã–µ –Ω–∞ –ª–µ–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ

-----

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
1. –°–¥–µ–ª–∞–π—Ç–µ fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è c —à–∞–±–ª–æ–Ω–æ–º —Ä–µ—à–µ–Ω–∏—è –∫ —Å–µ–±–µ –≤ Github –∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –µ–≥–æ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –Ω–æ–º–µ—Ä—É –∑–∞–Ω—è—Ç–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, https://github.com/–∏–º—è-–≤–∞—à–µ–≥–æ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è/gitlab-hw –∏–ª–∏ https://github.com/–∏–º—è-–≤–∞—à–µ–≥–æ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è/8-03-hw).
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∫ —Å–µ–±–µ –Ω–∞ –ü–ö —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã git clone.
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —É —Å–µ–±—è –ª–æ–∫–∞–ª—å–Ω–æ —ç—Ç–æ—Ç —Ñ–∞–π–ª README.md:
  - –≤–ø–∏—à–∏—Ç–µ –≤–≤–µ—Ä—Ö—É –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è –∏ –≤–∞—à–∏ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–º—è;
  - –≤ –∫–∞–∂–¥–æ–º –∑–∞–¥–∞–Ω–∏–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –≤ —Ç—Ä–µ–±—É–µ–º–æ–º –≤–∏–¥–µ: —Ç–µ–∫—Å—Ç/–∫–æ–¥/—Å–∫—Ä–∏–Ω—à–æ—Ç—ã/—Å—Å—ã–ª–∫–∞;
  - –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π ¬´–ö–∞–∫ –≤—Å—Ç–∞–≤–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –≤ —à–∞–±–ª–æ–Ω —Å —Ä–µ—à–µ–Ω–∏–µ–º¬ª;
  - –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–∞ —Ä–∞–∑–º–µ—Ç–∫–∏ md. –ö–æ—Ä–æ—Ç–∫–æ –æ–± —ç—Ç–æ–º –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ MarkDown.
4. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º —Å–¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç (git commit -m "comment") –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –Ω–∞ Github (git push origin).
5. –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ –≤ –≤–∏–¥–µ md-—Ñ–∞–π–ª–∞ –≤ –≤–∞—à–µ–º Github.
6. –õ—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∑–∞–¥–∞–≤–∞–π—Ç–µ –≤ —á–∞—Ç–µ —É—á–µ–±–Ω–æ–π –≥—Ä—É–ø–ø—ã –∏/–∏–ª–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–í–æ–ø—Ä–æ—Å—ã –ø–æ –∑–∞–¥–∞–Ω–∏—é¬ª –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ.

-----
### –ó–∞–¥–∞–Ω–∏–µ 1
  - –î–∞–Ω–∞ —Å—Ö–µ–º–∞ –¥–ª—è Cisco Packet Tracer, —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º–∞—è –≤ –ª–µ–∫—Ü–∏–∏.
  - –ù–∞ –¥–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ Gi0/1 (–¥–ª—è –Ω—É–ª–µ–≤–æ–π –≥—Ä—É–ø–ø—ã)
  - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ Gi0/0 (–¥–ª—è –ø–µ—Ä–≤–æ–π –≥—Ä—É–ø–ø—ã).
  - –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Ä–∞–∑–æ—Ä–≤–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –∫–∞–±–µ–ª–µ–π –º–µ–∂–¥—É –æ–¥–Ω–∏–º –∏–∑ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ –∏ Switch0 –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ ping –º–µ–∂–¥—É PC0 –∏ Server0.

 ### *–û—Ç–≤–µ—Ç*

## üñºÔ∏è –°–∫—Ä–∏–Ω—à–æ—Ç—ã —Ç–æ–ø–æ–ª–æ–≥–∏–∏ HSRP

![HSRP —Å—Ö–µ–º–∞ 1](images/hsrp_advanced-hw-1.png)  
*–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞ HSRP —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞–º–∏*

![HSRP —Å—Ö–µ–º–∞ 2](images/hsrp_advanced-hw-1_2.png)  
*–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ failover*

## üìÅ –°–∫–∞—á–∞—Ç—å –ø—Ä–æ–µ–∫—Ç Packet Tracer

[–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª hsrp_advanced-hw-1.pkt](./hsrp_advanced-hw-1.pkt)



-----
### –ó–∞–¥–∞–Ω–∏–µ 2
  - –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–≤–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã Linux, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ—Ä–≤–∏—Å Keepalived –∫–∞–∫ –≤ –ª–µ–∫—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.
  - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª—é–±–æ–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, nginx –∏–ª–∏ simple python server) –Ω–∞ –¥–≤—É—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö
  - –ù–∞–ø–∏—à–∏—Ç–µ Bash-—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω–æ–≥–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ index.html –≤ root-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω–æ–≥–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞.
  - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Keepalived —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –∑–∞–ø—É—Å–∫–∞–ª –¥–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–ª –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π IP –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä, –µ—Å–ª–∏ bash-—Å–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∞–ª—Å—è —Å –∫–æ–¥–æ–º, –æ—Ç–ª–∏—á–Ω—ã–º –æ—Ç –Ω—É–ª—è (—Ç–æ –µ—Å—Ç—å –ø–æ—Ä—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –±—ã–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª index.html). –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è —ç—Ç–æ–≥–æ —Å–µ–∫—Ü–∏—é vrrp_script
  - –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–ª—É—á–∏–≤—à–µ–π—Å—è bash-—Å–∫—Ä–∏–ø—Ç –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª keepalived, –∞ —Ç–∞–∫–∂–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π –ø–µ—Ä–µ–µ–∑–¥–∞ –ø–ª–∞–≤–∞—é—â–µ–≥–æ ip –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä –≤ —Å–ª—É—á–∞–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞ –∏–ª–∏ —Ñ–∞–π–ª–∞ index.html

 ### *–û—Ç–≤–µ—Ç*


### üîπ –§–∞–π–ª: [check_server.sh](task2/check_server.sh)


```bash
#!/bin/bash
if [[ $(netstat -ant | grep LISTEN | grep :80) ]] && [[ -f /var/www/html/index.nginx-debian.html ]]; then
  exit 0
else
  sudo systemctl stop keepalived
fi
```

üîπ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª MASTER:[keepalived-11.conf](task2/keepalived-11.conf)



```
vrrp_script check_server {
        script "/home/zabbix/check_server.sh"
        interval 3
}

vrrp_instance VI_1 {
        state MASTER
        interface enp0s8
        virtual_router_id 15
        priority 255
        advert_int 1

        virtual_ipaddress {
                192.168.56.100/24
        }

        track_script {
                check_server
        }
}
```

üîπ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª BACKUP: [keepalived-22.conf](task2/keepalived-22.conf)


```
vrrp_instance VI_1 {
        state BACKUP
        interface enp0s8
        virtual_router_id 15
        priority 155
        advert_int 1

        virtual_ipaddress {
                192.168.56.100/24
        }
}
```